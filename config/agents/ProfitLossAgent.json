{
  "class": "CustomAgent",
  "description": "Tracks profit/loss metrics and house performance. This agent can answer questions about financial performance, daily house P&L, and exposure logs. Tables: pl, daily_house_pl, exposure_log, ha_pl_entity, kpi_entity, daily_entry",
  "model_type": "bedrock",
  "model_name": "anthropic.claude-3-7-sonnet-20250219-v1:0",
  "system_prompt": [
    "",
    "You are ProfitLossAgent, a specialized database agent focused on profit/loss tracking and performance metrics.",
    "",
    "Your expertise covers these tables: pl, daily_house_pl, exposure_log, ha_pl_entity, kpi_entity, daily_entry.",
    "",
    "Additional Instructions:",
    "- When a user request requires multiple tool executions (e.g., multiple independent queries or lookups), dispatch these tool calls in parallel whenever possible to minimize response time.",
    "- Aggregate and summarize the results from all parallel tool calls before responding to the user.",
    "- If any tool call fails, report the error clearly but still return results from successful tool calls.",
    "- Only execute tool calls in parallel if they are independent and do not depend on each other's results.",
    "",
    "Instructions:",
    "- Only query the tables within your domain of expertise",
    "- Only allow and execute read-only queries (e.g., SELECT). Do NOT allow or execute any queries that edit, delete, or modify the database (such as UPDATE, DELETE, INSERT, ALTER, DROP, etc.).",
    "- Never fetch or return the entire database or very large datasets in a single response. If a query could return a large amount of data, use intelligent pagination and inform the user about the data size and how to request more if needed.",
    "- Always prioritize concise, relevant answers. Summarize or aggregate results when possible to avoid context overflow.",
    "- If a user requests a restricted action (edit, delete, modify), politely refuse and explain that only read-only access is permitted.",
    "- When answering, provide clear explanations in natural language. Do NOT show SQL queries unless the user explicitly asks for them (e.g., \"show SQL\" or \"give me the query\").",
    "- Do not ask users for query confirmation. Always infer the required details and generate the answer directly.",
    "- Provide answers in clear, natural language unless the user explicitly requests otherwise.",
    "- Focus on financial performance, daily house P&L, and exposure tracking"
  ],
  "tools": [
    "postgres_query",
    "append_memory"
  ],
  "parallel_tools": true,
  "max_parallel_tools": 3,
  "memory": [
    "[2025-08-23 12:52:48] Table: pl",
    "Primary Key: id",
    "Description: Stores profit and loss data for markets and events.",
    "Columns:",
    "- id (bigint, NOT NULL): Primary key",
    "- win_count (bigint): Number of winning bets",
    "- account_id (bigint): ID of the account",
    "- market_type (integer): Type of market",
    "- matched_bets (bigint): Number of matched bets",
    "- matched_risk (double precision): Risk amount for matched bets",
    "- net_risk (double precision): Net risk amount",
    "- open_count (bigint): Count of open bets",
    "- parent_id (bigint): Parent account ID",
    "- settlement_amount (double precision): Amount settled",
    "- unmatched_bets (bigint): Number of unmatched bets",
    "- unmatched_risk (double precision): Risk amount for unmatched bets",
    "- update_time (timestamp): Last update time",
    "- user_count (bigint): Count of users",
    "- voided_count (bigint): Count of voided bets",
    "- bets_count (bigint): Total count of bets",
    "- category_type (integer): Type of category",
    "- create_time (timestamp): Creation time",
    "- event_date (timestamp): Date of the event",
    "- house_id (bigint): ID of the house",
    "- lossback_amount (double precision): Amount of lossback",
    "- lost_count (bigint): Count of lost bets",
    "- market_status (integer): Status of the market",
    "- account_path (varchar): Path of the account",
    "- market_name (varchar): Name of the market",
    "- market_result (varchar): Result of the market",
    "- competition_id (varchar): ID of the competition",
    "- competition_name (varchar): Name of the competition",
    "- sport_id (varchar): ID of the sport",
    "- sports_book (varchar): Sports book name",
    "- event_id (varchar): ID of the event",
    "- event_name (varchar): Name of the event",
    "- provider_id (varchar): ID of the provider",
    "- role (varchar): Role",
    "- username (varchar): Username",
    "- market_id (varchar): ID of the market",
    "",
    "[2025-08-23 12:52:56] Table: daily_house_pl",
    "Primary Key: id",
    "Description: Stores daily profit and loss data for houses.",
    "Columns:",
    "- id (bigint, NOT NULL): Primary key",
    "- affiliate_bonus (numeric, default 0.00): Affiliate bonus amount",
    "- closing_balance (numeric, default 0.00): Closing balance",
    "- create_time (timestamp with time zone, default CURRENT_TIMESTAMP): Creation time",
    "- end_date (timestamp with time zone, default CURRENT_TIMESTAMP): End date",
    "- house_id (bigint, NOT NULL): ID of the house",
    "- house_pl (numeric, default 0.00): House profit/loss",
    "- opening_balance (numeric, default 0.00): Opening balance",
    "- start_date (timestamp with time zone, default CURRENT_TIMESTAMP): Start date",
    "- total_house_pl (numeric, default 0.00): Total house profit/loss",
    "- update_time (timestamp with time zone, default CURRENT_TIMESTAMP): Update time",
    "- user_bonus (numeric, default 0.00): User bonus amount",
    "- user_deposit (numeric, default 0.00): User deposit amount",
    "- user_pg_deposit (numeric, default 0.00): User payment gateway deposit amount",
    "- user_pg_withdrawal (numeric, default 0.00): User payment gateway withdrawal amount",
    "- user_refund (numeric, default 0.00): User refund amount",
    "- user_settlement_deposit (numeric, default 0.00): User settlement deposit amount",
    "- user_settlement_withdrawal (numeric, default 0.00): User settlement withdrawal amount",
    "- user_win_comm_deposit (numeric, default 0.00): User win commission deposit amount",
    "- user_win_comm_withdrawal (numeric, default 0.00): User win commission withdrawal amount",
    "- user_withdrawal (numeric, default 0.00): User withdrawal amount",
    "- version (bigint): Version number",
    "",
    "[2025-08-23 12:53:02] Table: exposure_log",
    "Primary Key: id",
    "Description: Logs user exposure data for bets and markets.",
    "Columns:",
    "- id (bigint, NOT NULL): Primary key",
    "- user_id (bigint, NOT NULL): ID of the user",
    "- create_time (timestamp): Creation time",
    "- exposure (double precision, NOT NULL): Exposure amount",
    "- transaction_type (integer): Type of transaction",
    "- provider_id (varchar): ID of the provider",
    "- event_id (varchar): ID of the event",
    "- event_name (varchar): Name of the event",
    "- sport_id (varchar): ID of the sport",
    "- game_type (varchar): Type of game",
    "- market_id (varchar): ID of the market",
    "- market_name (varchar): Name of the market",
    "- bet_id (varchar): ID of the bet",
    "- category (varchar): Category",
    "- competition_id (varchar): ID of the competition",
    "- competition_name (varchar): Name of the competition",
    "",
    "[2025-08-23 12:53:07] Table: ha_pl_entity",
    "Primary Key: id",
    "Description: Stores house account profit and loss entity data.",
    "Columns:",
    "- id (varchar, NOT NULL): Primary key",
    "- day (date, NOT NULL): Date of the record",
    "- house_id (bigint, NOT NULL): ID of the house",
    "- profit (double precision, NOT NULL): Profit amount",
    "- category_type (varchar, NOT NULL): Type of category",
    "",
    "[2025-08-23 12:53:12] Table: kpi_entity",
    "Primary Key: id",
    "Description: Stores Key Performance Indicator data.",
    "Columns:",
    "- id (bigint, NOT NULL): Primary key",
    "- create_time (timestamp, NOT NULL): Creation time",
    "- reference_id (bigint): Reference ID",
    "- value (double precision, NOT NULL): Value of the KPI",
    "- account_mode (integer): Mode of the account",
    "- account_id (bigint): ID of the account",
    "- account_path (varchar, NOT NULL): Path of the account",
    "- category (varchar, NOT NULL): Category",
    "- sub_category (varchar, NOT NULL): Sub-category",
    "- username (varchar): Username",
    "- sports_book (varchar): Sports book name",
    "",
    "[2025-08-23 12:53:22] Table: daily_entry",
    "Primary Key: id",
    "Description: Stores daily entry data for accounts including financial metrics.",
    "Columns:",
    "- id (bigint, NOT NULL): Primary key",
    "- house_id (bigint): ID of the house",
    "- account_id (bigint): ID of the account",
    "- parent_id (bigint): Parent account ID",
    "- interval (smallint): Interval",
    "- start_date (timestamp with time zone, default now()): Start date",
    "- end_date (timestamp with time zone, default now()): End date",
    "- create_time (timestamp with time zone, default now()): Creation time",
    "- update_time (timestamp with time zone, default now()): Update time",
    "- placed_stake (numeric, default 0): Placed stake amount",
    "- returns (numeric, default 0): Returns amount",
    "- pl (numeric, default 0): Profit/Loss amount",
    "- deposits (bigint, default 0): Number of deposits",
    "- withdrawals (bigint, default 0): Number of withdrawals",
    "- deposit_amount (numeric, default 0): Total deposit amount",
    "- withdrawal_amount (numeric, default 0): Total withdrawal amount",
    "- sign_ups (bigint, default 0): Number of sign ups",
    "- first_deposits (bigint, default 0): Number of first deposits",
    "- first_deposits_amount (numeric, default 0): Amount of first deposits",
    "- life_time_sign_ups (bigint, default 0): Lifetime sign ups",
    "- life_time_deposits (bigint, default 0): Lifetime deposits",
    "- life_time_deposits_amount (bigint, default 0): Lifetime deposit amount",
    "- life_time_withdrawals (bigint, default 0): Lifetime withdrawals",
    "- life_time_withdraw_amount (bigint, default 0): Lifetime withdrawal amount",
    "- life_time_first_deposits (bigint, default 0): Lifetime first deposits",
    "- life_time_ftd_amount (numeric, default 0): Lifetime first deposit amount",
    "- life_time_placed_stake (numeric, default 0): Lifetime placed stake",
    "- life_time_profit (numeric, default 0): Lifetime profit",
    "- version (bigint): Version number",
    "- username (varchar): Username",
    "- sports_book (varchar): Sports book name",
    "- role (varchar): Role",
    "- account_path (varchar): Path of the account",
    "- affiliate_path (varchar): Path of the affiliate",
    "",
    "[2025-08-23 12:53:32] Table Relationships:",
    "",
    "1. house_id is a common key across multiple tables:",
    "   - pl.house_id",
    "   - daily_house_pl.house_id",
    "   - ha_pl_entity.house_id",
    "   - daily_entry.house_id",
    "   These can be joined to analyze profit/loss data across different house entities.",
    "",
    "2. account_id is present in:",
    "   - pl.account_id",
    "   - kpi_entity.account_id",
    "   - daily_entry.account_id",
    "   This can be used to link account-specific data across tables.",
    "",
    "3. User identification:",
    "   - exposure_log.user_id identifies specific users",
    "   - pl.username, kpi_entity.username, and daily_entry.username can be used to track user activities",
    "",
    "4. Time-based analysis:",
    "   - pl.create_time, pl.update_time, pl.event_date",
    "   - daily_house_pl.create_time, daily_house_pl.update_time, daily_house_pl.start_date, daily_house_pl.end_date",
    "   - exposure_log.create_time",
    "   - kpi_entity.create_time",
    "   - daily_entry.create_time, daily_entry.update_time, daily_entry.start_date, daily_entry.end_date",
    "   - ha_pl_entity.day",
    "   These can be used for time-series analysis and reporting periods.",
    "",
    "5. Market and event identification:",
    "   - pl.market_id, pl.event_id",
    "   - exposure_log.market_id, exposure_log.event_id",
    "   These can be used to analyze specific markets or events.",
    "",
    "6. Sports and competition data:",
    "   - pl.sport_id, pl.competition_id",
    "   - exposure_log.sport_id, exposure_log.competition_id",
    "   These can be used to analyze performance by sport or competition.",
    "",
    "[2025-08-23 12:53:40] Common Query Patterns:",
    "",
    "1. Daily Profit/Loss Analysis:",
    "   - Query daily_house_pl with date filters to analyze daily P&L",
    "   - Join with ha_pl_entity to get category-specific P&L breakdown",
    "   - Use daily_entry for more detailed metrics by account",
    "",
    "2. User Exposure Analysis:",
    "   - Query exposure_log filtered by user_id, event_id, or market_id",
    "   - Aggregate exposure by sport, competition, or market",
    "   - Track exposure changes over time",
    "",
    "3. Market Performance:",
    "   - Use pl table to analyze performance of specific markets",
    "   - Group by market_id, event_id, or sport_id",
    "   - Calculate win rates and settlement amounts",
    "",
    "4. KPI Tracking:",
    "   - Query kpi_entity filtered by category and sub_category",
    "   - Analyze KPI trends over time using create_time",
    "   - Compare KPIs across different accounts or sports books",
    "",
    "5. Account Hierarchy Analysis:",
    "   - Use account_path in pl, kpi_entity, and daily_entry",
    "   - Analyze performance across different levels of the account hierarchy",
    "   - Roll up metrics from child accounts to parent accounts",
    "",
    "6. Time-Series Analysis:",
    "   - Use date fields across tables for trend analysis",
    "   - Compare performance across different time periods",
    "   - Identify seasonal patterns or anomalies"
  ]
}