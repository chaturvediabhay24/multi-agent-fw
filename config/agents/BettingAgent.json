{
  "class": "CustomAgent",
  "description": "Manages sports betting, customer orders, and betting exposures. This agent can answer questions about bets, market exposures, and sports books. Tables: customer_order, customer_order_old, market_exposure, market_exposure_old, sports_book, sports_book_aliases, sports_book_level_games, order_domain_event, order_limit, order_setting, system_bet_locked_user, sap_pending_bets",
  "model_type": "bedrock",
  "model_name": "anthropic.claude-3-7-sonnet-20250219-v1:0",
  "system_prompt": [
    "",
    "You are BettingAgent, a specialized database agent focused on sports betting and customer orders.",
    "",
    "Your expertise covers these tables: customer_order, customer_order_old, market_exposure, market_exposure_old, sports_book, sports_book_aliases, sports_book_level_games, order_domain_event, order_limit, order_setting, system_bet_locked_user, sap_pending_bets.",
    "",
    "Additional Instructions:",
    "- When a user request requires multiple tool executions (e.g., multiple independent queries or lookups), dispatch these tool calls in parallel whenever possible to minimize response time.",
    "- Aggregate and summarize the results from all parallel tool calls before responding to the user.",
    "- If any tool call fails, report the error clearly but still return results from successful tool calls.",
    "- Only execute tool calls in parallel if they are independent and do not depend on each other's results.",
    "",
    "Instructions:",
    "- Only query the tables within your domain of expertise",
    "- Only allow and execute read-only queries (e.g., SELECT). Do NOT allow or execute any queries that edit, delete, or modify the database (such as UPDATE, DELETE, INSERT, ALTER, DROP, etc.).",
    "- Never fetch or return the entire database or very large datasets in a single response. If a query could return a large amount of data, use intelligent pagination and inform the user about the data size and how to request more if needed.",
    "- Always prioritize concise, relevant answers. Summarize or aggregate results when possible to avoid context overflow.",
    "- If a user requests a restricted action (edit, delete, modify), politely refuse and explain that only read-only access is permitted.",
    "- When answering, provide clear explanations in natural language. Do NOT show SQL queries unless the user explicitly asks for them (e.g., \"show SQL\" or \"give me the query\").",
    "- Do not ask users for query confirmation. Always infer the required details and generate the answer directly.",
    "- Provide answers in clear, natural language unless the user explicitly requests otherwise.",
    "- Focus on bets, market exposures, and sports book operations"
  ],
  "tools": [
    "postgres_query",
    "append_memory"
  ],
  "parallel_tools": true,
  "max_parallel_tools": 3,
  "memory": [
    "[2025-08-23 12:44:41] Database Schema Information:",
    "",
    "1. customer_order table:",
    "- Key columns: order_id (bigint, NOT NULL)",
    "- Important fields: account_id, username, placed_stake, matched_stake, placed_odd, matched_odd, returns, status, placed_time, update_time",
    "- Contains bet details including event information (sport_id, sport_name, event_id, event_name)",
    "- Tracks market information (market_id, market_name, market_type)",
    "- Contains outcome information (outcome_id, outcome_name)",
    "- Financial details: placed_stake, matched_stake, cancelled_stake, remaining_stake, returns",
    "- Status tracking: status, sub_status, alert_status",
    "",
    "2. customer_order_old table:",
    "- Similar structure to customer_order",
    "- Appears to be a historical/archive table for older orders",
    "- Key columns: order_id (bigint, NOT NULL)",
    "- Contains similar betting and financial information as customer_order",
    "",
    "3. market_exposure table:",
    "- Key columns: id (bigint, NOT NULL)",
    "- Tracks exposure by market",
    "- Contains account information: account_id, account_key, account_path, username",
    "- Event information: sport_id, event_id, event_name, competition_id, competition_name",
    "- Market information: market_id, market_name, market_type, market_status, market_result",
    "- Financial metrics: matched_risk, unmatched_risk, net_risk, settlement_amount, sap_matched_risk, sap_unmatched_risk, sap_settlement_amount",
    "- Betting metrics: bets_count, matched_bets, unmatched_bets, win_count, voided_count",
    "- Timestamp fields: create_time, update_time, event_date, market_create_time",
    "",
    "4. market_exposure_old table:",
    "- Historical/archive version of market_exposure",
    "- Similar structure to market_exposure",
    "- Key columns: id (bigint, NOT NULL)",
    "",
    "5. sports_book table:",
    "- Key columns: sports_book_url (varchar, NOT NULL)",
    "- Contains configuration for sports book operations",
    "- Features enabled/disabled flags: affiliate_enabled, b2c_enabled, bonus_enabled, demo_user_enabled, payments_enabled, signup_enabled, casino_enabled, sports_enabled",
    "- Business settings: sports_book_edge, casino_edge, affiliate_commission",
    "- Administrative info: admin, house_id, manager",
    "- UI settings: welcome_page, languages, skins",
    "",
    "6. sports_book_aliases table:",
    "- Links aliases to sports books",
    "- Key columns: alias (varchar, NOT NULL)",
    "- Contains: sports_book, house_id, is_skin flag",
    "",
    "7. sports_book_level_games table:",
    "- Maps sports books to game IDs",
    "- Key columns: sports_book_url (varchar, NOT NULL)",
    "- Contains: game_ids",
    "",
    "8. order_domain_event table:",
    "- Tracks events related to orders",
    "- Key columns: id (bigint, NOT NULL)",
    "- Contains: type, source, time, data (bytea), data_content_type",
    "",
    "9. order_limit table:",
    "- Defines limits for orders",
    "- Key columns: id (bigint, NOT NULL)",
    "- Contains: house_id, limit_key, limit_item (bytea), create_time, update_time, updated_by",
    "",
    "10. order_setting table:",
    "- Settings for orders by account path",
    "- Key columns: account_path (varchar, NOT NULL)",
    "- Contains: commission_setting (bytea), hold_percentage, create_time",
    "",
    "11. system_bet_locked_user table:",
    "- Tracks users with locked bets",
    "- Key columns: id (bigint, NOT NULL)",
    "- Contains: user_id, username, balance, exposure, create_time",
    "",
    "12. sap_pending_bets table:",
    "- Tracks pending bets in the system",
    "- Key columns: id (bigint, NOT NULL)",
    "- Contains bet details: bet_id, bet_type, amount, odd_value, risk",
    "- User information: user_id, username, account_path",
    "- Event information: event_id, event_name, event_date, sport_id",
    "- Market information: market_id, market_name, market_type",
    "- Status tracking: status, is_bet_placed",
    "- Timestamp fields: create_time, update_time",
    "",
    "Key relationships between tables:",
    "- customer_order and market_exposure can be joined on market_id, event_id, account_id",
    "- sports_book and sports_book_aliases can be joined on sports_book_url and sports_book",
    "- customer_order and sap_pending_bets can be related through bet_id/order_id",
    "- system_bet_locked_user can be joined with customer_order on user_id/account_id",
    "- order_setting can be linked to customer_order through account_path",
    "",
    "[2025-08-23 12:44:51] Status codes and types in customer_order table:",
    "- order_type: Integer field that likely indicates bet type (back, lay, etc.)",
    "- status: Integer field that tracks the overall status of the order (pending, matched, settled, etc.)",
    "- sub_status: Integer field providing additional status details",
    "- alert_status: Integer field possibly indicating if the order requires attention",
    "",
    "Market exposure tracking:",
    "- market_exposure table contains detailed risk analysis for markets",
    "- Fields like matched_risk, unmatched_risk, and net_risk show financial exposure",
    "- settlement_amount indicates the final financial outcome after market settlement",
    "- bets_count, matched_bets, unmatched_bets provide volume metrics",
    "- win_count and voided_count track bet outcomes",
    "",
    "Relationships between tables:",
    "1. customer_order ↔ market_exposure:",
    "   - Join on market_id, event_id, account_id/username",
    "   - This relationship shows individual bets and their contribution to market exposure",
    "",
    "2. sports_book ↔ sports_book_aliases:",
    "   - Join on sports_book_url = sports_book",
    "   - This shows all aliases for a particular sports book",
    "",
    "3. customer_order ↔ sap_pending_bets:",
    "   - Pending bets eventually become customer orders",
    "   - Can track the lifecycle of a bet from pending to placed",
    "",
    "4. order_setting ↔ customer_order:",
    "   - Settings defined at account_path level apply to orders placed under that path",
    "   - Commission settings and hold percentages are defined here",
    "",
    "5. market_exposure ↔ market_exposure_old:",
    "   - Historical record of market exposures",
    "   - Useful for analyzing how exposure changed over time",
    "",
    "6. customer_order ↔ customer_order_old:",
    "   - Historical record of customer orders",
    "   - Useful for analyzing past betting patterns",
    "",
    "[2025-08-23 12:45:01] Common Query Patterns:",
    "",
    "1. Customer Order Analysis:",
    "   - Filter orders by status, time period, username, or sport",
    "   - Aggregate financial metrics like total stake, returns, or profit",
    "   - Group by market, event, or time period for trend analysis",
    "",
    "2. Market Exposure Analysis:",
    "   - Analyze risk exposure across markets, events, or sports",
    "   - Identify markets with highest financial exposure",
    "   - Track settlement outcomes against exposure",
    "",
    "3. Sports Book Configuration:",
    "   - View enabled features for specific sports books",
    "   - Check commission and edge settings",
    "   - Verify alias configurations",
    "",
    "4. User Betting Activity:",
    "   - Track betting patterns for specific users",
    "   - Analyze stake sizes, bet types, and preferred markets",
    "   - Calculate user profitability over time",
    "",
    "5. Event and Market Analysis:",
    "   - Analyze betting volume by event or market",
    "   - Calculate market profitability",
    "   - Track market status changes",
    "",
    "Data Types and Special Considerations:",
    "- Binary data (bytea) in several tables may contain serialized objects requiring special handling",
    "- Timestamp fields use timezone information (timestamp with time zone)",
    "- Numeric fields for financial data ensure precision",
    "- Character varying fields may have different length constraints",
    "- Boolean flags indicate feature enablement or status conditions",
    "",
    "Primary Keys and Indexing:",
    "- Most tables use an 'id' column as primary key",
    "- sports_book uses sports_book_url as primary key",
    "- sports_book_aliases uses alias as primary key",
    "- order_setting uses account_path as primary key",
    "- These keys are important for efficient joins and lookups",
    "",
    "[2025-08-26 11:01:38] The system does not appear to have explicit delay timer configurations stored in the available database tables. The order_limit table has limit_key values that follow a structured format (HA/house_id/CT/SPORTS/SI/sport_id/CI/competition_id/...) but no visible delay timer settings. The house_settings table contains various configuration parameters but none specifically related to bet delays or time restrictions."
  ]
}