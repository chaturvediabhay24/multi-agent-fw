{
  "class": "CustomAgent",
  "description": "Tracks domain events and system changes. This agent can answer questions about system events, catalog changes, and database modifications. Tables: account_domain_event, wallet_domain_event, order_domain_event, catalog_domain_event, databasechangelog, databasechangeloglock, shedlock",
  "model_type": "bedrock",
  "model_name": "anthropic.claude-3-7-sonnet-20250219-v1:0",
  "system_prompt": [
    "",
    "You are EventTrackingAgent, a specialized database agent focused on domain events and system tracking.",
    "",
    "Your expertise covers these tables: account_domain_event, wallet_domain_event, order_domain_event, catalog_domain_event, databasechangelog, databasechangeloglock, shedlock.",
    "",
    "Additional Instructions:",
    "- When a user request requires multiple tool executions (e.g., multiple independent queries or lookups), dispatch these tool calls in parallel whenever possible to minimize response time.",
    "- Aggregate and summarize the results from all parallel tool calls before responding to the user.",
    "- If any tool call fails, report the error clearly but still return results from successful tool calls.",
    "- Only execute tool calls in parallel if they are independent and do not depend on each other's results.",
    "",
    "Instructions:",
    "- Only query the tables within your domain of expertise",
    "- Only allow and execute read-only queries (e.g., SELECT). Do NOT allow or execute any queries that edit, delete, or modify the database (such as UPDATE, DELETE, INSERT, ALTER, DROP, etc.).",
    "- Never fetch or return the entire database or very large datasets in a single response. If a query could return a large amount of data, use intelligent pagination and inform the user about the data size and how to request more if needed.",
    "- Always prioritize concise, relevant answers. Summarize or aggregate results when possible to avoid context overflow.",
    "- If a user requests a restricted action (edit, delete, modify), politely refuse and explain that only read-only access is permitted.",
    "- When answering, provide clear explanations in natural language. Do NOT show SQL queries unless the user explicitly asks for them (e.g., \"show SQL\" or \"give me the query\").",
    "- Do not ask users for query confirmation. Always infer the required details and generate the answer directly.",
    "- Provide answers in clear, natural language unless the user explicitly requests otherwise.",
    "- Focus on system events, catalog changes, and database modifications"
  ],
  "tools": [
    "postgres_query",
    "append_memory"
  ],
  "parallel_tools": true,
  "max_parallel_tools": 3,
  "memory": [
    "[2025-08-23 12:59:34] Table: account_domain_event",
    "Columns:",
    "- id: bigint, NOT NULL (Primary key)",
    "- data: bytea, nullable",
    "- data_content_type: character varying, nullable",
    "- source: character varying, nullable",
    "- time: timestamp with time zone, nullable, default: CURRENT_TIMESTAMP(6)",
    "- type: character varying, nullable",
    "Purpose: Stores domain events related to account operations/changes.",
    "",
    "[2025-08-23 12:59:41] Table: wallet_domain_event",
    "Columns:",
    "- id: bigint, NOT NULL (Primary key)",
    "- data: bytea, nullable",
    "- data_content_type: character varying, nullable",
    "- source: character varying, nullable",
    "- time: timestamp with time zone, nullable, default: CURRENT_TIMESTAMP(6)",
    "- type: character varying, nullable",
    "Purpose: Stores domain events related to wallet operations/changes.",
    "",
    "[2025-08-23 12:59:48] Table: order_domain_event",
    "Columns:",
    "- id: bigint, NOT NULL (Primary key)",
    "- data: bytea, nullable",
    "- data_content_type: character varying, nullable",
    "- source: character varying, nullable",
    "- time: timestamp with time zone, nullable, default: CURRENT_TIMESTAMP(6)",
    "- type: character varying, nullable",
    "Purpose: Stores domain events related to order operations/changes.",
    "",
    "[2025-08-23 12:59:56] Table: catalog_domain_event",
    "Columns:",
    "- id: bigint, NOT NULL (Primary key)",
    "- data: bytea, nullable",
    "- data_content_type: character varying, nullable",
    "- house_id: bigint, nullable",
    "- source: character varying, nullable",
    "- time: timestamp with time zone, nullable, default: CURRENT_TIMESTAMP(6)",
    "- type: character varying, nullable",
    "Purpose: Stores domain events related to catalog operations/changes. Has an additional house_id column not present in other domain event tables.",
    "",
    "[2025-08-23 13:00:06] Table: databasechangelog",
    "Columns:",
    "- id: character varying, NOT NULL (Part of composite primary key)",
    "- author: character varying, NOT NULL (Part of composite primary key)",
    "- filename: character varying, NOT NULL (Part of composite primary key)",
    "- dateexecuted: timestamp without time zone, NOT NULL",
    "- orderexecuted: integer, NOT NULL",
    "- exectype: character varying, NOT NULL",
    "- md5sum: character varying, nullable",
    "- description: character varying, nullable",
    "- comments: character varying, nullable",
    "- tag: character varying, nullable",
    "- liquibase: character varying, nullable",
    "- contexts: character varying, nullable",
    "- labels: character varying, nullable",
    "- deployment_id: character varying, nullable",
    "Purpose: Tracks database schema changes managed by Liquibase. Contains records of all database migrations that have been applied.",
    "",
    "[2025-08-23 13:00:14] Table: databasechangeloglock",
    "Columns:",
    "- id: integer, NOT NULL (Primary key)",
    "- locked: boolean, NOT NULL",
    "- lockgranted: timestamp without time zone, nullable",
    "- lockedby: character varying, nullable",
    "Purpose: Used by Liquibase to prevent multiple instances from attempting to update the database simultaneously. Acts as a locking mechanism for database migrations.",
    "",
    "[2025-08-23 13:00:23] Table: shedlock",
    "Columns:",
    "- name: character varying, NOT NULL (Primary key)",
    "- lock_until: timestamp without time zone, nullable",
    "- locked_at: timestamp without time zone, nullable",
    "- locked_by: character varying, nullable",
    "Purpose: Used for distributed task scheduling, ensuring that scheduled tasks in a clustered environment run only once at the same time (prevents duplicate execution).",
    "",
    "[2025-08-23 13:00:31] Domain Event Tables Common Pattern:",
    "The tables account_domain_event, wallet_domain_event, order_domain_event, and catalog_domain_event share a similar structure:",
    "- All have 'id' as primary key (bigint)",
    "- All contain 'data' column (bytea) that likely stores serialized event data",
    "- All have 'data_content_type' to indicate the format of the data",
    "- All have 'source' to indicate the origin of the event",
    "- All have 'time' with default CURRENT_TIMESTAMP(6)",
    "- All have 'type' to classify the event",
    "- Only catalog_domain_event has an additional 'house_id' column",
    "",
    "Database Management Tables:",
    "- databasechangelog: Tracks database schema changes (Liquibase migrations)",
    "- databasechangeloglock: Prevents concurrent Liquibase migrations",
    "- shedlock: Manages distributed task scheduling locks",
    "",
    "Relationships:",
    "- The domain event tables don't appear to have direct foreign key relationships with each other",
    "- They likely relate to other tables in the system not included in this exploration",
    "- The domain event tables follow the event sourcing pattern, capturing state changes in the system",
    "",
    "[2025-08-23 13:00:37] Query Patterns:",
    "1. To query domain events by time range:",
    "   SELECT * FROM [domain_event_table] WHERE time BETWEEN [start_time] AND [end_time]",
    "",
    "2. To query domain events by type:",
    "   SELECT * FROM [domain_event_table] WHERE type = '[event_type]'",
    "",
    "3. To count events by type:",
    "   SELECT type, COUNT(*) FROM [domain_event_table] GROUP BY type",
    "",
    "4. To find recent database changes:",
    "   SELECT id, author, filename, dateexecuted, description FROM databasechangelog ORDER BY dateexecuted DESC LIMIT [n]",
    "",
    "5. To check if any database migration is currently running:",
    "   SELECT * FROM databasechangeloglock WHERE locked = true",
    "",
    "6. To check scheduled tasks that are currently locked:",
    "   SELECT * FROM shedlock WHERE lock_until > NOW()",
    "",
    "7. For catalog events related to a specific house:",
    "   SELECT * FROM catalog_domain_event WHERE house_id = [house_id]",
    "",
    "[2025-08-26 11:03:57] The domain event tables (account_domain_event, wallet_domain_event, order_domain_event, catalog_domain_event) store serialized event data in the 'data' column as binary data (bytea) with data_content_type typically being 'application/protobuf'. This means the actual configuration values are stored in serialized format that cannot be directly queried with SQL."
  ]
}